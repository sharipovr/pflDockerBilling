# –≠—Ç–∞–ø 1: –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
FROM node:20-alpine AS builder

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package.json –∏ package-lock.json
COPY package.json package-lock.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN npm install

# –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
COPY . .

# –í—ã–ø–æ–ª–Ω—è–µ–º —Å–±–æ—Ä–∫—É TypeScript + Vite
RUN npm run build

# –≠—Ç–∞–ø 2: Production –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å Nginx
FROM nginx:stable-alpine

# –ö–æ–ø–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–π –±–∏–ª–¥ –≤ –ø–∞–ø–∫—É —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ Nginx
COPY --from=builder /app/dist /usr/share/nginx/html

# üëá –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ñ–∏–≥ Nginx
COPY ./nginx/default.conf /etc/nginx/conf.d/default.conf

# –û—Ç–∫—Ä—ã–≤–∞–µ–º 80 –ø–æ—Ä—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–Ω–µ
EXPOSE 80

# –°—Ç–∞—Ä—Ç—É–µ–º Nginx
CMD ["nginx", "-g", "daemon off;"]
